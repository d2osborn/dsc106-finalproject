<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>The Effect of 2 Strikes on a Hitter's Swing</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script type="module" src="story graphs/vis.js"></script>
    <script type="module" src="story graphs/contactscatter.js"></script>
    <script type="module" src="story graphs/radar.js"></script>
    <script type="module" src="story graphs/yordanstats.js"></script>
    <script type="module" src="story graphs/overall.js"></script>
    <script type="module" src="story graphs/deltaHists.js"></script>    

    <script type="module">
        import { drawAttackAngle } from './graphs/attackAngle.js';
        import { drawBatSpeed } from './graphs/batSpeed.js';
        import { drawSwingPathTilt } from './graphs/swingPathTilt.js';
        import { drawDirectionAngle } from './graphs/directionAngle.js';

        window.addEventListener('DOMContentLoaded', () => {
            const controls = d3.select('.sandbox-controls');
            controls.html(`
                <div style="display:flex;align-items:center;gap:1em;">
                    <label style="color:#fff;font-weight:bold;">Player:
                        <input id="player-input" list="player-list" placeholder="e.g. Shohei Ohtani" autocomplete="off"
                               style="padding:0.4em 0.8em;font-size:1em;">
                        <datalist id="player-list"></datalist>
                    </label>
                    <label style="color:#fff;font-weight:bold;">Count:
                        <label><input type="radio" name="count" value="0-0" checked>0-0</label>
                        <label><input type="radio" name="count" value="0-2">0-2</label>
                    </label>
                </div>
            `);
            const inputElem = document.getElementById('player-input');
            const dataList = document.getElementById('player-list');
            const radios = Array.from(document.getElementsByName('count'));

            d3.csv('files/combined_data.csv', d3.autoType).then(data => {
                const players = Array.from(new Set(
                  data.map(d => d.batter_name.trim()).filter(n => n)
                )).sort();
                function populate(list) {
                    dataList.innerHTML = list.map(n => `<option value="${n}">`).join('');
                }

                inputElem.addEventListener('input', () => {
                    const v = inputElem.value.toLowerCase();
                    populate(
                      v ? players.filter(p => p.toLowerCase().includes(v)).slice(0, 10) : []
                    );
                });

                function getMax(field) {
                    if (field === 'attack_angle') return 25;
                    const m = d3.max(data, d => +d[field]) || 1;
                    return Math.ceil(m / 10) * 10;
                }
                const maxAttackAngle   = getMax('attack_angle');
                const maxBatSpeed      = getMax('bat_speed');
                const maxSwingPathTilt = Math.ceil(
                  (d3.max(data, d => Math.abs(+d.swing_path_tilt)) || 60) / 10
                ) * 10;

                function getCount() {
                    const c = radios.find(r => r.checked);
                    return c ? c.value : null;
                }

                function update() {
                    const p = inputElem.value.trim();
                    const c = getCount();
                    let filtered = [], showData = [];

                    if (players.includes(p) && c) {
                        filtered = data.filter(d =>
                          d.batter_name === p &&
                          ((c === '0-0' && d.balls === 0 && d.strikes === 0) ||
                           (c === '0-2' && d.balls === 0 && d.strikes === 2))
                        );
                        showData = filtered.length > 0 ? filtered : [];
                    }
                    if (showData.length === 0 && c) {
                        showData = data.filter(d =>
                          (c === '0-0' && d.balls === 0 && d.strikes === 0) ||
                          (c === '0-2' && d.balls === 0 && d.strikes === 2)
                        );
                    }
                    if (showData.length === 0) {
                        showData = data;
                    }

                    // Clear prior charts
                    d3.select('#zone-map').html('');
                    d3.select('#outcome-scatter').html('');
                    d3.select('#attack-angle-plot').html('');
                    d3.select('#direction-angle-plot').html('');

                    // Re‐draw all four graphs
                    drawAttackAngle(d3.select('#zone-map'), showData, {
                        title: 'Attack Angle (°)',
                        max:   maxAttackAngle
                    });
                    drawBatSpeed(d3.select('#outcome-scatter'), showData, {
                        title: 'Bat Speed (mph)',
                        max:   maxBatSpeed
                    });
                    drawSwingPathTilt(d3.select('#direction-angle-plot'), showData, {
                        title: 'Swing Path Tilt (°)',
                        max:   maxSwingPathTilt
                    });
                    drawDirectionAngle(d3.select('#attack-angle-plot'), showData, {
                        title: 'Direction Angle (°)',
                        max:   maxAttackAngle
                    });

                    // Compute league or player averages
                    const avgAttack = d3.mean(showData, d => +d.attack_angle) || 0;
                    const avgDir    = d3.mean(showData, d => +d.attack_direction) || 0;
                    const avgTilt   = d3.mean(showData, d => +d.swing_path_tilt) || 0;

                    console.log('showData:', showData);
                    console.log('Calculated avgDir:', avgDir);
                    console.log('Calculated avgTilt:', avgTilt);

                    // Send to 3D swing animation
                    if (window.updateAttackAngleVisualization) {
                        window.updateAttackAngleVisualization(avgAttack);
                    }
                    if (window.updateDirectionAngleVisualization) {
                        window.updateDirectionAngleVisualization(avgDir);
                    }
                    if (window.updateSwingPathTilt) {
                        window.updateSwingPathTilt(avgTilt);
                    }
                }

                inputElem.addEventListener('change', update);
                inputElem.addEventListener('keyup', e => { if (e.key === 'Enter') update(); });
                radios.forEach(r => r.addEventListener('change', update));

                // Initial draw (MLB averages)
                update();

                window.__statcast_full_data__ = data;
            });
        });
    </script>
</head>
<body>
    <h1 class="main-title" id="dynamic-title"></h1>

    <div class="video-effect-container">
        <canvas id="effect-canvas"></canvas>
        <video id="source-video" src="images/yordan.mp4" preload="auto" crossorigin="anonymous" style="display:none;" muted autoplay loop></video>
        
        <div class="scroll-arrows" onclick="scrollPastVideo()">&#x276F;&#x276F;&#x276F;</div>
    </div>
    <p class="intro">
        Yordan Álvarez, the Cuban-born designated hitter/left fielder for the Houston Astros, enjoyed a breakout 2024 campaign in which he slashed .308 AVG, .392 OBP, .567 SLG (.959 OPS) over 147 games (635 PA), belted 35 homers, drove in 86 runs and scored 88 times while earning his third consecutive All-Star nod (his first as the AL’s starting DH), hit for the cycle on July 21, and launched his 150th career home run in just 590 games—the eighth-fastest mark in MLB history; he was voted Astros MVP by the local BBWAA chapter, named to the All-MLB Second Team, and finished ninth in AL MVP voting
    </p>
        <!-- TOOLTIP -->
        <div id="tooltip"
             style="opacity:0; position:absolute; pointer-events:none;
                    background:white; border:1px solid #ccc; padding:6px;
                    border-radius:4px; font-size:12px; z-index:1000;">
        </div>
      
        <!-- …your video, titles, etc… -->
      
        <!-- SIDE-BY-SIDE STATS & CHART -->
        <div id="chart-stats-container" style="display: flex; gap: 20px;">
            <div id="stats" class="chart" style="flex: 0.6;"></div>
            <div id="overall-graph" class="chart" style="flex: 1.4;"></div>
        </div>
      
    
    <section class="section-container">
        <p class="intro">
            Yordan Alverz is known for his consistent at bat approach even at tough situations like 2-strike counts. 
            At 2 strikes, it's common knowledge that hitters are taught to use a "B swing".
            Batters tends to focus more on making contact to survive or to get on the base instead of trying to slug the ball.
            However, that leads to them losing quality of hits. 
            Yordan Alverz stands out even from the MLB level hitters because even at 2 strikes he successfully make contacts that has high quality(shown in wOBA).
            What is is doing different?
        </p>
          <div id="scatter-contact-woba" class="chart"></div>



          <!-- Attack Angle Section -->
          <div id="radarChart"></div>
          <p class="radar">
            Yordan Alverz, compare to other MLB hitters, has noticible top notch attributes.
            Couple of things to focus on this radar graph are the chase and the oppo rate.
            Oppo rate represents ...
            Chase rate represents that he came out of his comfort zone and trying his best to make contact.
            This analysis can be highlighted more in density graph.
        </p>
          <div class="graph-section">
              <div class="graph-explanation">
                  <p>
                      The distribution of attack angle changes between 0-strike and 2-strike counts reveals how hitters adjust their swing plane.
                      Yordan Alvarez shows a significant shift in his attack angle, moving from a more upward swing in 0-strike counts to a flatter plane with two strikes.
                      This adjustment helps him maintain contact while sacrificing some power potential.
                  </p>
              </div>
          </div>

          <!-- Swing Path Tilt Section
          <div class="graph-section">
              <div class="chart-container">
                  <div id="swing-path-chart" class="chart"></div>
                  <div id="swing-path-comparison" class="chart"></div>
              </div>
              <div class="graph-explanation">
                  <p>
                      The swing path tilt visualization shows how hitters modify their swing plane's orientation.
                      With two strikes, many hitters flatten their swing path to increase contact probability.
                      Alvarez's ability to maintain power despite these adjustments is what makes his two-strike approach unique.
                  </p>
              </div>
          </div> -->

          <!-- Contact Zone Section -->
          <div class="graph-section">
              <div class="heatmap-row">
                  <div class="plot-pair">
                      <div id="heatmap0" class="heatmap" style="margin-top: 5rem;"></div>
                      <div id="heatmap2" class="heatmap" style="margin-top: 5rem;"></div>
                  </div>
                  <div class="plot-text">
                      <h3 style="color: #EB6E1F;">Contact% Between Counts</h3>
                      <p>
                          As we can see from the side-by-side strike zone heatmaps, Yordan's contact% changes drastically from 0-strike counts to 2-strike counts. 
                          We can see how in 0-strike counts, he prefers to make contact more inside and along the middle of the zone, but in 2-strike counts, he expands his zone and even tends to make contact away.
                          This not only tells us that Yordan is willing to adjust his approach, but also that he can maintain quality contact even when expanding his zone.
                      </p>
                  </div>
              </div>
          </div>
          <p class="And">
            <br></br>
            For further analysis, we can encorporate Baseball Savant recently released new swing metrics: attack angle (º), attack direction (º), and swing path (tilt) (º)<br><br>
            These new metrics allow the public to take a deeper dive into swing geometry and better understand how hitters approach each at-bat. 
            Their swing geometry can dramatically affect batted-ball outcomes like wOBA, contact%, and groundball%.

            To help reveal the relationship between a hitter's swing characteristics and the outcomes they produce, we have segmented situations based on the strike counts.
            Let's dive deeper into Yordan Alverz's change in swings.
            Compared to his 0-strike approach, he shows increase in variance in all three metrics. This results reveals that he adjusts his swings in order to stay alive.
            Out of all the metrics he showed the greatest change in attack angle, that he will focus more on quality hit than slugging.
            Compared to other hitters, he was moderate to low in change in variance for Swing tilt or attact direction. This result could mean that although he is changing his tilt of his upper body but the angle that his arms and his body makes remain consistent.
            Do the data reveal major leaguers follow Yordan's approach?
        </p>
          <!-- Delta Histograms Section -->
          <section class="graph-section">
              <div id="delta-hists" class="histogram-row"></div>
          </section>
          <p class = "But">
            Here's change in variance scatter plot for the each metrics against important outcome rates.
            Explore league-wide trend and see how Yordan Alverez's appraoch can be justified.
            You can also dive deeper into player specific data down in the sandbox.
          </p>

      </section>

    <!-- Correlation Section -->
    <div id="correlation-section"></div>

    <!-- SANDBOX SECTION -->
    <section class="sandbox-section">
        <h2 class="sandbox-title">Explore How MLB Hitters Adjust in Two Strike Counts</h2>
        
        <!-- Controls -->
        <div class="sandbox-controls">
            <div style="display:flex;align-items:center;gap:1em;">
                <label style="color:#fff;font-weight:bold;">Player:
                    <input id="player-input" list="player-list" placeholder="e.g., Shohei Ohtani" autocomplete="off"
                           style="padding:0.4em 0.8em;font-size:1em;">
                    <datalist id="player-list"></datalist>
                </label>
                <label style="color:#fff;font-weight:bold;">Count:
                    <label><input type="radio" name="count" value="0-0" checked>0-0</label>
                    <label><input type="radio" name="count" value="0-2">0-2</label>
                </label>
            </div>
        </div>

        <!-- Dashboard Layout -->
        <div class="sandbox-layout">
            <!-- Left side: Small rectangle and 3D model container -->
            <div class="left-container">
                <div class="small-rectangle"></div>
                <div class="animation-container">
                    <div class="sandbox-viz" id="animation-swing"></div>
                </div>
            </div>
            
            <!-- Right side: 2x2 grid of squares -->
            <div class="graphs-container">
                <div id="zone-map" class="sandbox-viz"></div>
                <div id="outcome-scatter" class="sandbox-viz"></div>
                <div id="attack-angle-plot" class="sandbox-viz"></div>
                <div id="direction-angle-plot" class="sandbox-viz"></div>
            </div>
        </div>
    </section>
    <p class="Therefore">
        There seemed to be no textbook answer for swing adjustment at tough situations. 
        However, these new metrics brought us more clear idea there are combinations of change in approach that players can benefit from.
        The players with this knowledge can develop their unique swing geometry change.
        The mangers and coaches can also get analytical views on their players' approach to build sounder line up.
        These metrics, even though very insightful, should be taken into considerations of other components such as height, weight, ability to track the ball, bat speed, pressure, mentality.
        Therefore, it would be more comprehensive for further research that could encompass the other compounding factors. 
        

    </p>
    <script>
        const titleWords = [
            ["The  ", "Effect"],
            ["of"],
            ["2  ", "Strikes"],
            ["on", "a"],
            ["Hitter's  ", "Swing"]
        ];

        const highlightWords = new Set(["THE  ", "EFFECT", "2  ", "STRIKES", "HITTER'S  ", "SWING"]);
        const specialColors = {
            "2  ": "#ffffff",
            "STRIKES": "#ffffff",
            "EFFECT": "#ffffff"
        };

        let html = "";
        for (let line of titleWords) {
            html += `<div style="margin-bottom: 0.4vw;">`;
            for (let word of line) {
                const wordUpper = word.toUpperCase();
                const fontSize = highlightWords.has(wordUpper) ? "4vw" : "1.5vw";
                const color = specialColors[wordUpper] || "#ffffff";
                html += `<span style="color:${color}; opacity:0.95; font-size:${fontSize}; margin-right: 0.4vw;">${wordUpper}</span>`;
            }
            html += `</div>`;
        }
        document.getElementById("dynamic-title").innerHTML = html.trim();

    
    
        // Video effect
        const video = document.getElementById('source-video');
        const canvas = document.getElementById('effect-canvas');
        const ctx = canvas.getContext('2d');
    
        function resizeCanvas() {
            const container = document.querySelector('.video-effect-container');
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
    
        function drawVideo() {
            if (video.readyState >= 2) {
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            }
            requestAnimationFrame(drawVideo);
        }
        video.addEventListener('canplay', () => {
            video.playbackRate = 1.25;
            video.play();
            drawVideo();
        });
    
        // Scroll past the video when arrows are clicked
        function scrollPastVideo() {
            const videoContainer = document.querySelector('.video-effect-container');
            window.scrollTo({
                top: videoContainer.offsetHeight,
                behavior: 'smooth'
            });
        }
    </script>
    

    <!-- Import the 3D animation script -->
    <script type="module" src="./graphs/swingAnimationWithOBJ.js"></script>
    <script type="module" src="vis/heatmap.js"></script>
    <script type="module" src="story graphs/leagueCorrelation.js"></script>
</body>
</html>